#+TITLE: Emacs Configuration
#+AUTHOR: Alfred Roos
#+PROPERTY: header-args:emacs-lisp :mkdirp yes
#+STARTUP: overview

* Table of Contents :TOC:
- [[#introduction][Introduction]]
- [[#installation][Installation]]
  - [[#auto-tangle-on-save][Auto-tangle on save]]
- [[#main-configuration-initel][Main Configuration (init.el)]]
- [[#package-management-lisppackagesel][Package Management (lisp/packages.el)]]
  - [[#package-setup][Package Setup]]
  - [[#version-control][Version Control]]
  - [[#completion-framework][Completion Framework]]
  - [[#project-management--navigation][Project Management & Navigation]]
  - [[#web-development][Web Development]]
  - [[#lsp--java-development][LSP & Java Development]]
  - [[#theme--visual][Theme & Visual]]
  - [[#editing-enhancements][Editing Enhancements]]
  - [[#javascripttypescript][JavaScript/TypeScript]]
  - [[#syntax-highlighting--editing][Syntax Highlighting & Editing]]
  - [[#file-management][File Management]]
  - [[#productivity--utilities][Productivity & Utilities]]
  - [[#window-management][Window Management]]
  - [[#enhanced-completion-ui][Enhanced Completion UI]]
  - [[#additional-utilities][Additional Utilities]]
- [[#keybindings-lispkeybindingsel][Keybindings (lisp/keybindings.el)]]
  - [[#project--navigation][Project & Navigation]]
  - [[#code-folding][Code Folding]]
  - [[#multiple-cursors][Multiple Cursors]]
  - [[#buffer-management][Buffer Management]]
  - [[#compilation][Compilation]]
  - [[#window-management-1][Window Management]]
  - [[#lsp][LSP]]
  - [[#dired][Dired]]
- [[#ui-configuration-lispuiel][UI Configuration (lisp/ui.el)]]
  - [[#basic-ui-settings][Basic UI Settings]]
  - [[#line-numbers--highlighting][Line Numbers & Highlighting]]
  - [[#indentation][Indentation]]
  - [[#yesno-prompts][Yes/No Prompts]]
  - [[#auto-save-configuration][Auto-save Configuration]]
  - [[#cursor-configuration][Cursor Configuration]]
  - [[#editing-modes][Editing Modes]]
  - [[#web-mode-settings][Web Mode Settings]]
  - [[#theme][Theme]]
  - [[#dired-settings][Dired Settings]]
  - [[#dashboard][Dashboard]]
  - [[#custom-functions][Custom Functions]]
- [[#tree-sitter-lisptreesitterel][Tree-sitter (lisp/treesitter.el)]]
- [[#notes][Notes]]

* Introduction

This is my literate Emacs configuration using Org mode. The configuration is organized into separate files for better modularity.

To use this configuration:
1. Clone or copy this =README.org= to your =~/.config/emacs/= directory
2. Run =M-x org-babel-tangle= or save this file to generate all config files
3. Restart Emacs
  
* Installation

** Auto-tangle on save

Add this to your existing init.el to auto-tangle this file on save:

#+begin_src emacs-lisp :tangle no
(defun my/org-babel-tangle-config ()
  (when (string-equal (buffer-file-name)
                      (expand-file-name "README.org" user-emacs-directory))
    (let ((org-confirm-babel-evaluate nil))
      (org-babel-tangle)
      (message "Configuration tangled!"))))

(add-hook 'org-mode-hook
          (lambda ()
            (add-hook 'after-save-hook #'my/org-babel-tangle-config)))
#+end_src

* Main Configuration (init.el)

The main entry point that loads all other configuration modules.

#+begin_src emacs-lisp :tangle ~/.config/emacs/init.el
;; Load custom Emacs Lisp files
(add-to-list 'load-path "/home/spy/.config/emacs/lisp")
(setq browse-url-browser-function 'browse-url-firefox)

;; Java Configuration
(setenv "JAVA_HOME" "/usr/lib/jvm/default")
(setq exec-path (cons (concat (getenv "JAVA_HOME") "/bin") exec-path))

;; Disable auto-save files
(setq auto-save-default nil
      auto-save-list-file-prefix nil)

;; Disable backup files
(setq make-backup-files nil)

;; Disable lockfiles
(setq create-lockfiles nil)

;; Disable desktop save
(setq desktop-save nil)

;; LSP performance optimization
(setq gc-cons-threshold 100000000) ;; 100 MB

(setq password-cache t)
(setq password-cache-expiry 3600) ;; 1 hour

(setq truncate-lines t)

;; Load configuration modules
(load "secret")
(load "packages")
(load "ui")
(load "keybindings")
(load "treesitter")


;; Custom file configuration
(setq custom-file (expand-file-name "custom.el" user-emacs-directory))
(when (file-exists-p custom-file)
  (load custom-file))
#+end_src

* Package Management (lisp/packages.el)

All package declarations and configurations.

** Package Setup

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/packages.el
(require 'package)

;; Add package archives
(setq package-archives
      '(("melpa" . "https://melpa.org/packages/")
        ("gnu"   . "https://elpa.gnu.org/packages/")
        ("org"   . "https://orgmode.org/elpa/")))

;; Initialize the package system
(package-initialize)

;; Refresh package contents if needed
(unless package-archive-contents
  (package-refresh-contents))

;; Install use-package if not already installed
(unless (package-installed-p 'use-package)
  (package-install 'use-package))

(require 'use-package)
(setq use-package-always-ensure t)
#+end_src

** Version Control

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/packages.el
(use-package magit
  :ensure t
  :defer t
  :bind (("C-x g" . magit-status)))
#+end_src

** Completion Framework

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/packages.el
(use-package which-key
  :init (which-key-mode)
  :diminish which-key-mode
  :config
  (setq which-key-idle-delay 0.5))

;; Enable Vertico
(use-package vertico
  :init
  (vertico-mode 1))

(use-package orderless
  :init
  (setq completion-styles '(orderless)
        completion-category-defaults nil
        completion-category-overrides '((file (styles partial-completion)))))

;; Persist history over Emacs restarts
(use-package savehist
  :init
  (savehist-mode 1))

;; Emacs minibuffer configurations
(setq enable-recursive-minibuffers t
      read-extended-command-predicate #'command-completion-default-include-p
      minibuffer-prompt-properties
      '(read-only t cursor-intangible t face minibuffer-prompt))

;; Optional: Enable context menu mode
(context-menu-mode 1)

(use-package consult
  :bind (("C-s" . consult-line)
         ("C-x b" . consult-buffer)
         ("M-y" . consult-yank-pop)))

(use-package embark
  :bind (("M-o" . embark-act)
         ("C-h B" . embark-bindings))
  :init (setq prefix-help-command #'embark-prefix-help-command))

(use-package expand-region
  :bind ("C-=" . er/expand-region))

(use-package embark-consult
  :after (embark consult)
  :hook (embark-collect-mode . consult-preview-at-point-mode))
#+end_src

** Project Management & Navigation

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/packages.el
(use-package treemacs)
(use-package fold-this)
(use-package projectile)
#+end_src

** Web Development

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/packages.el
(use-package web-mode
  :ensure t
  :mode
  (("\\.phtml\\'" . web-mode)
   ("\\.php\\'" . web-mode)
   ("\\.ts\\'" . web-mode)
   ("\\.tsx\\'" . web-mode)
   ("\\.tpl\\'" . web-mode)
   ("\\.[agj]sp\\'" . web-mode)
   ("\\.as[cp]x\\'" . web-mode)
   ("\\.erb\\'" . web-mode)
   ("\\.mustache\\'" . web-mode)
   ("\\.djhtml\\'" . web-mode)))
#+end_src

** LSP & Java Development

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/packages.el
    (use-package lsp-mode
      :commands lsp
      :config
      (setq lsp-prefer-flymake nil   ;; Use flycheck instead of flymake
            lsp-enable-snippet t
            lsp-completion-provider :capf))

    (use-package lsp-ui
      :commands lsp-ui-mode
      :config
      (setq lsp-ui-doc-enable t
            lsp-ui-sideline-enable t
            lsp-ui-sideline-show-code-actions t))

    (use-package lsp-treemacs
      :after lsp)

    (use-package company
      :config
      (setq company-minimum-prefix-length 1
            company-idle-delay 0.0))

    (use-package dap-mode
      :after lsp-mode
      :config
      (dap-auto-configure-mode)
      ;; Enable java debugging support
      )

      (use-package java-snippets)
#+end_src

** Theme & Visual

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/packages.el
(use-package all-the-icons :if (display-graphic-p))
(use-package doom-themes)
(use-package kanagawa-themes)

;;(use-package doom-modeline
;;  :init
;;  (doom-modeline-mode 0)
;;  :custom
;;  ;; Optional tweaks
;;  (doom-modeline-height 25)
;;  (doom-modeline-bar-width 3)
;;  (doom-modeline-buffer-file-name-style 'truncate-with-project)
;;  (doom-modeline-minor-modes nil)
;;	(doom-modeline-enable-word-count t)
;;  (doom-modeline-indent-info t)
;;	(doom-modeline-major-mode-icon t)
;;  (doom-modeline-icon t))  ;; requires all-the-icons package
#+end_src

** Editing Enhancements

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/packages.el
(use-package multiple-cursors)

(use-package eyebrowse
  :ensure t
  :config
  ;; Enable eyebrowse
  (eyebrowse-mode t)

  ;; Optional: start with a specific number of workspaces
  (setq eyebrowse-new-workspace t)

  ;; Keybindings for quick workspace switching
  (global-set-key (kbd "M-1") 'eyebrowse-switch-to-window-config-1)
  (global-set-key (kbd "M-2") 'eyebrowse-switch-to-window-config-2)
  (global-set-key (kbd "M-3") 'eyebrowse-switch-to-window-config-3)
  (global-set-key (kbd "M-4") 'eyebrowse-switch-to-window-config-4)
  (global-set-key (kbd "M-0") 'eyebrowse-last-window-config)

  ;; Optional: customize the modeline indicator
  (setq eyebrowse-mode-line-separator " | ")
  (setq eyebrowse-new-workspace t)
  (setq eyebrowse-mode-line-left-delimiter "[")
  (setq eyebrowse-mode-line-right-delimiter "]")
  (setq eyebrowse-mode-line-style 'smart))

#+end_src

** JavaScript/TypeScript

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/packages.el
(use-package jtsx
  :ensure t
  :mode (("\\.jsx?\\'" . jtsx-jsx-mode)
         ("\\.tsx\\'" . jtsx-tsx-mode))

  :commands jtsx-install-treesit-language
  :hook ((jtsx-jsx-mode . hs-minor-mode)
         (jtsx-tsx-mode . hs-minor-mode)
         (jtsx-typescript-mode . hs-minor-mode))
  :custom
  ;; Optional customizations
  (js-indent-level 4)
  ;; (typescript-ts-mode-indent-offset 2)
  ;; (jtsx-switch-indent-offset 0)
  ;; (jtsx-indent-statement-block-regarding-standalone-parent nil)
  ;; (jtsx-jsx-element-move-allow-step-out t)
  ;; (jtsx-enable-jsx-electric-closing-element t)
  ;; (jtsx-enable-electric-open-newline-between-jsx-element-tags t)
  ;; (jtsx-enable-jsx-element-tags-auto-sync nil)
  ;; (jtsx-enable-all-syntax-highlighting-features t)
  :config
  (defun jtsx-bind-keys-to-mode-map (mode-map)
    "Bind keys to MODE-MAP."
    (define-key mode-map (kbd "C-c C-j") 'jtsx-jump-jsx-element-tag-dwim)
    (define-key mode-map (kbd "C-c j o") 'jtsx-jump-jsx-opening-tag)
    (define-key mode-map (kbd "C-c j c") 'jtsx-jump-jsx-closing-tag)
    (define-key mode-map (kbd "C-c j r") 'jtsx-rename-jsx-element)
    (define-key mode-map (kbd "C-c <down>") 'jtsx-move-jsx-element-tag-forward)
    (define-key mode-map (kbd "C-c <up>") 'jtsx-move-jsx-element-tag-backward)
    (define-key mode-map (kbd "C-c C-<down>") 'jtsx-move-jsx-element-forward)
    (define-key mode-map (kbd "C-c C-<up>") 'jtsx-move-jsx-element-backward)
    (define-key mode-map (kbd "C-c C-S-<down>") 'jtsx-move-jsx-element-step-in-forward)
    (define-key mode-map (kbd "C-c C-S-<up>") 'jtsx-move-jsx-element-step-in-backward)
    (define-key mode-map (kbd "C-c j w") 'jtsx-wrap-in-jsx-element)
    (define-key mode-map (kbd "C-c j u") 'jtsx-unwrap-jsx)
    (define-key mode-map (kbd "C-c j d n") 'jtsx-delete-jsx-node)
    (define-key mode-map (kbd "C-c j d a") 'jtsx-delete-jsx-attribute)
    (define-key mode-map (kbd "C-c j t") 'jtsx-toggle-jsx-attributes-orientation)
    (define-key mode-map (kbd "C-c j h") 'jtsx-rearrange-jsx-attributes-horizontally)
    (define-key mode-map (kbd "C-c j v") 'jtsx-rearrange-jsx-attributes-vertically))
    
  (defun jtsx-bind-keys-to-jtsx-jsx-mode-map ()
      (jtsx-bind-keys-to-mode-map jtsx-jsx-mode-map))

  (defun jtsx-bind-keys-to-jtsx-tsx-mode-map ()
      (jtsx-bind-keys-to-mode-map jtsx-tsx-mode-map))

  (add-hook 'jtsx-jsx-mode-hook 'jtsx-bind-keys-to-jtsx-jsx-mode-map)
  (add-hook 'jtsx-tsx-mode-hook 'jtsx-bind-keys-to-jtsx-tsx-mode-map))
#+end_src

** WEB
#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/packages.el
(use-package emmet-mode
  :ensure t
  :hook ((html-mode web-mode css-mode) . emmet-mode)
  :config
  (setq emmet-expand-jsx-className? t) ;; Optional for React/JSX
  (setq emmet-move-cursor-between-quotes t))

;;(with-eval-after-load 'emmet-mode
;;  (define-key emmet-mode-keymap (kbd "TAB") 'emmet-expand-line))


(use-package company-web
  :ensure t
  :after company
  :config
  (add-to-list 'company-backends 'company-web-html))

#+end_src

** Syntax Highlighting & Editing

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/packages.el
(use-package rainbow-delimiters)
(use-package smartparens)
(use-package kdl-mode)
#+end_src

** File Management

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/packages.el
(use-package diredfl
  :hook (dired-mode . diredfl-mode))
#+end_src

** Productivity & Utilities

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/packages.el
(use-package wakatime-mode)
(global-wakatime-mode 1)
#+end_src

** Window Management

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/packages.el
(use-package shackle)
(setq shackle-rules
      '((compilation-mode :align bottom :size 0.25 :select f)
        (grep-mode        :align bottom :size 0.25 :select f)
        (help-mode        :align right  :size 0.4 :select f)
        (Man-mode         :align right  :size 0.5 :select f)))
(shackle-mode 1)
;; (setq compilation-scroll-output 'first-error
;;       compilation-ask-about-save nil
;;       compilation-auto-jump-to-first-error t)

(use-package golden-ratio)
#+end_src

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/ui.el

(defun my/split-window-right-and-focus ()
  "Split the window vertically and move focus to the new one."
  (interactive)
  (split-window-right)
  (other-window 1))

(defun my/split-window-below-and-focus ()
  "Split the window vertically and move focus to the new one."
  (interactive)
  (split-window-below)
  (other-window 1))


#+end_src

** Enhanced Completion UI

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/packages.el
;; adds a frame in the middle where we use vertico
(use-package posframe
  :ensure t)

(use-package vertico-posframe
  :after vertico posframe
  :ensure t
  :custom
  (vertico-posframe-width 120)
  (vertico-posframe-min-width 50)
  (vertico-posframe-parameters '((left-fringe . 8) (right-fringe . 8)))
  :init
  (vertico-posframe-mode 0))

(use-package marginalia
  ;; Bind `marginalia-cycle' locally in the minibuffer.  To make the binding
  ;; available in the *Completions* buffer, add it to the
  ;; `completion-list-mode-map'.
  :bind (:map minibuffer-local-map
         ("M-A" . marginalia-cycle))

  ;; The :init section is always executed.
  :init

  ;; Marginalia must be activated in the :init section of use-package such that
  ;; the mode gets enabled right away. Note that this forces loading the
  ;; package.
  (marginalia-mode))
#+end_src

** cuda
#+begin_src emacs-lisp ~/.config/emacs/lisp/packages.elblack
(require 'dap-gdb-lldb)

;; Configure CUDA debugger
(dap-register-debug-template "CUDA C++ gdb"
														 (list :type "gdb"
																	 :request "launch"
																	 :name "CUDA Debug"
																	 :gdbpath "cuda-gdb"   ;; Path to cuda-gdb
																	 :target nil           ;; Your compiled program
																	 :cwd nil))

#+end_src

** Additional Utilities

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/packages.el
(use-package ace-window)
(setq aw-keys '(?a ?s ?d ?f ?g ?h ?j ?k ?l))
(use-package all-the-icons)
(use-package all-the-icons-ibuffer)

;;(use-package eglot
;;  :ensure t
;;  :hook (java-mode . eglot-ensure)
;;  :config
;;  ;; point to the Eclipse JDT Language Server if needed
;;  (add-to-list 'eglot-server-programs
;;               '(java-mode . ("jdtls"))))

(use-package dashboard
  :ensure t
  :config
  (dashboard-setup-startup-hook))

(use-package jetbrains-darcula-theme)
(use-package pyvenv)
(use-package fancy-compilation)
#+end_src

** ELFEED
#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/packages.el
(use-package elfeed)
(setq elfeed-feeds
      '("http://nullprogram.com/feed/"
				"http://irreal.org/blog/"
				"https://archlinux.org/feeds/news/"
				"https://fosspost.org/feed"
				"https://feeds.feedburner.com/GoogleOpenSourceBlog"
        "https://planet.emacslife.com/atom.xml"))
#+end_src

** GPTEL
#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/packages.el
(use-package gptel)
;; :key can be a function that returns the API key.
(defvar gemini-api-key nil
  "Gemini API key loaded from a secure untracked location.")
(gptel-make-gemini "gemini-2.5-flash-lite" :key gemini-api-key :stream t)
(setq gptel-backend (gptel-get-backend "gemini-2.5-flash-lite"))

#+end_src

** Request
#+begin_src emacs-lisp
(request "http://httpbin.org/get"
  :params '(("key" . "value") ("key2" . "value2"))
  :parser 'json-read
  :success (cl-function
            (lambda (&key data &allow-other-keys)
              (message "I sent: %S" (assoc-default 'args data)))))  
#+end_src

** Shell
#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/packages.el
  (use-package esh-autosuggest
  :hook (eshell-mode . esh-autosuggest-mode)
  ;; If you have use-package-hook-name-suffix set to nil, uncomment and use the
  ;; line below instead:
  ;; :hook (eshell-mode-hook . esh-autosuggest-mode)
  :ensure t)
#+end_src

* Keybindings (lisp/keybindings.el)

All custom keybindings organized by category.

** Project & Navigation

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/keybindings.el
;; Treemacs
(global-set-key [f8] 'treemacs)
(global-set-key (kbd "C-c o p") 'treemacs)
(global-set-key (kbd "C-x p s") 'consult-ripgrep)

;; Projectile
(projectile-mode +1)
(define-key projectile-mode-map (kbd "C-c p") 'projectile-command-map)
#+end_src

** Code Folding

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/keybindings.el
;; fold this
;;(global-set-key (kbd "C-c C-f") 'fold-this-all)
(global-set-key (kbd "C-c C-f") 'fold-this)
(global-set-key (kbd "C-c M-f") 'fold-this-unfold-all)
#+end_src

** Multiple Cursors

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/keybindings.el
;; multiple cursor
(global-set-key (kbd "C-<") 'mc/mark-next-like-this)
(global-set-key (kbd "C->") 'mc/mark-previous-like-this)

(define-key key-translation-map (kbd "M-S-d") (kbd "M-D"))
(global-set-key (kbd "M-D") 'mc/mark-next-like-this-word)
#+end_src

** Buffer Management

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/keybindings.el
(global-set-key (kbd "C-x C-b") 'ibuffer)
(global-set-key (kbd "C-x 3") #'my/split-window-right-and-focus)
(global-set-key (kbd "C-x 2") #'my/split-window-below-and-focus)
#+end_src

** Compilation

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/keybindings.el
;;compile
(global-set-key (kbd "C-c c c") 'compile)
(global-set-key (kbd "C-c c C") 'recompile)
(global-set-key (kbd "C-c p c c") 'projectile-compile-project)

(global-set-key [f10] 'recompile)


(keymap-set compilation-mode-map "C-<return>" 'compilation-next-error)
#+end_src

#+begin_src emacs-lisp :tangle ~/.config/emacs/init.el
(setq compilation-jump-to-first-error nil)
(require 'ansi-color)
(add-hook 'compilation-filter-hook 'ansi-color-compilation-filter)
#+end_src


Makes so the cursor doesnt go to compile buffre
#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/ui.el
(setq compilation-finish-functions
      (lambda (buf msg)
        (when (string-match ".*finished" msg)
          (message "Compilation finished successfully."))))

(setq display-buffer-alist
      '(("\\*compilation\\*"
         (display-buffer-reuse-window display-buffer-at-bottom)
         (window-height . 0.3)
         (inhibit-same-window . t))))


#+end_src

** Window Management

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/keybindings.el
;; ace-window
(defun ace-window-golden-ratio()
	(interactive)
	 (ace-window nil)
	 (golden-ratio))
(global-set-key (kbd "C-x o") 'ace-window-golden-ratio)
#+end_src

** Shell
#+begin_src emacs-lisp  :tangle ~/.config/emacs/lisp/keybindings.el
(global-set-key (kbd "C-c o RET") 'eshell)
(global-set-key (kbd "C-<return>") 'eshell)
#+end_src

** LSP

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/keybindings.el
;;lsp
(global-set-key (kbd "C-c c d") 'lsp-goto-type-definition)
#+end_src

** Org mode
#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/keybindings.el
(keymap-set emacs-lisp-mode-map "C-c r" 'eval-buffer)
#+end_src

** Yassnipet
#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/packages.el
(use-package yasnippet)
(yas-global-mode 1)
#+end_src
** Dired

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/keybindings.el
(add-hook 'dired-mode-hook
          (lambda ()
            (define-key dired-mode-map [mouse-1] 'dired-find-alternate-file)))

(put 'dired-find-alternate-file 'disabled nil)

#+end_src

** ETC
#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/keybindings.el
(global-set-key (kbd "C-h l") 'consult-theme)

(defun rc/duplicate-line ()
  "Duplicate current line"
  (interactive)
  (let ((column (- (point) (point-at-bol)))
        (line (let ((s (thing-at-point 'line t)))
                (if s (string-remove-suffix "\n" s) ""))))
    (move-end-of-line 1)
    (newline)
    (insert line)
    (move-beginning-of-line 1)
    (forward-char column)))


(global-set-key (kbd "C-.") 'rc/duplicate-line)
#+end_src

** increment
#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/keybindings.el
  (defun increment(amnt)
	(interactive)
 	(let ((bounds (bounds-of-thing-at-point 'number)))
		(if bounds
				(let* (
				 (beg (car bounds))
				 (end (cdr bounds))
				 (deleted (delete-and-extract-region beg end)))
		(insert (format "%s" ( + amnt (string-to-number deleted))))))
))

(global-set-key (kbd "C-S-i")
                (lambda () (interactive) (increment 1)))
(global-set-key (kbd "C-M-S-i")
                (lambda () (interactive) (increment -1)))
#+end_src


* UI Configuration (lisp/ui.el)

Visual and interface settings.

** Basic UI Settings
#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/packages.el
  (use-package mlscroll)
  (use-package good-scroll)
#+end_src

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/ui.el
(setq inhibit-startup-message t  ; Don't show the splash screen
      visible-bell t)            ; Flash when the bell rings

;; Disable unnecessary UI elements
(menu-bar-mode -1)
(tool-bar-mode -1)
(scroll-bar-mode -1)

(mlscroll-mode)
(good-scroll-mode)

(add-to-list 'default-frame-alist '(font . "Iosevka-14"))
;;(add-to-list 'default-frame-alist '(font . "Iosevka" ))
(set-face-attribute 'default t :font "Iosevka" :weight 'bold )

(set-frame-font "Iosevka SemiBold-14" t t)

#+end_src
** Modeline
#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/ui.el
;; Function to show current workspace in the mode-line
(defun my/mode-line-workspace ()
  "Return the current Eyebrowse workspace as a string for the mode-line."
  (let* ((current-slot (eyebrowse--get 'current-slot))
         (slots (eyebrowse--get 'window-configs))
         ;; Optional: mark active workspace
         (formatted-slots
          (mapcar (lambda (slot)
                    (let ((num (car slot)))
                      (if (= num current-slot)
                          (propertize (format "[%d]" num)
                                      'face '(:weight bold :foreground "green"))
                        (format "%d" num))))
                  slots)))
    ;; Join all slots into a string like "1 2 [3] 4"
    (string-join formatted-slots " ")))

(defun my/mode-line-scroll ()
  "Return the current scroll position in the buffer as a percentage for the mode-line."
  (let ((min (point-min))
        (max (point-max))
        (pos (point)))
    (if (= max min)
        "Top" ;; empty or very small buffer
      (format "%d%%" (/ (* 100 (- pos min)) (- max min))))))

(defun my/mode-line-wordcount ()
  "Return the word count of the buffer as a string for the mode-line.
Only displays for text-like modes (text, org, markdown)."
  (if (derived-mode-p 'text-mode 'org-mode 'markdown-mode)
      (format "%dW" (count-words (point-min) (point-max)))
    "")) ;; return empty string for other modes

(defun my/mode-line-git-branch ()
  "Return current Git branch for mode-line, or nil."
  (when-let ((file buffer-file-name)
             (backend (vc-backend file)))
    (when (eq backend 'Git)
      (when-let ((branch (vc-git--symbolic-ref file)))
        (concat " " branch)))))


(setq moody-mode-line-height 20)

(setq-default mode-line-format
  '(
    ;; Workspace (Eyebrowse)
    (:eval (my/mode-line-workspace))
    " | "
    
    ;; **Just use mode-line-buffer-identification**; Moody will style it automatically
    mode-line-buffer-identification
    " | "
    
    ;; Scroll %
    (:eval (my/mode-line-scroll))
    " | "
    
    ;; Line number
    "%l | "
    
    ;; Word count
    (:eval (my/mode-line-wordcount))
    " | "
    
    ;; Space indicator
    (:eval (if indent-tabs-mode "Tab" "Spc"))
    " | "
    
    ;; Major mode
    mode-name
    " | "
    
    ;; Minor modes
    minor-mode-alist
    " | "
    
    ;; Git branch
    (:eval (my/mode-line-git-branch))
    " | "
    
    ;; Time
    (:eval (format-time-string "%H:%M"))
		" | "
		(:eval (format-time-string "%A(%d) %B V%W "))
    ))




(require 'moody)
(moody-replace-mode-line-front-space)
(moody-replace-mode-line-buffer-identification)
(moody-replace-vc-mode)
(setq x-underline-at-descent-line t) ;; optional: underline style

#+end_src

** Org mode
#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/ui.el
;; Modern Org Mode Configuration
;; A sleek, feature-rich setup for Org mode

;; ============================================================================
;; CORE ORG SETTINGS
;; ============================================================================

(use-package org
  :ensure nil
  :custom
  ;; Directories
  (org-directory "~/org/")
  (org-default-notes-file (concat org-directory "inbox.org"))
  
  ;; Visual settings
  (org-startup-indented t)
  (org-pretty-entities t)
  (org-hide-emphasis-markers t)
  (org-startup-with-inline-images t)
  (org-image-actual-width '(300))
  
  ;; Behavior
  (org-edit-src-content-indentation 0)
  (org-src-tab-acts-natively t)
  (org-src-preserve-indentation t)
  (org-return-follows-link t)
  (org-confirm-babel-evaluate nil)
  
  ;; Todo keywords
  (org-todo-keywords
   '((sequence "TODO(t)" "NEXT(n)" "PROG(p)" "WAIT(w@/!)" "|" "DONE(d!)" "CANCELLED(c@)")))
  
  (org-todo-keyword-faces
   '(("TODO" . (:foreground "#ff6c6b" :weight bold))
     ("NEXT" . (:foreground "#51afef" :weight bold))
     ("PROG" . (:foreground "#c678dd" :weight bold))
     ("WAIT" . (:foreground "#ecbe7b" :weight bold))
     ("DONE" . (:foreground "#98be65" :weight bold))
     ("CANCELLED" . (:foreground "#5b6268" :weight bold))))

#+end_src
** c3-mode
#+begin_src emacs-lisp :tangle ~/.config/emacs/init.el
  (load "c3-mode.el")
#+end_src

** Agenda  
#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/ui.el

  (org-agenda-files (list org-directory))
  (org-agenda-start-with-log-mode t)
  (org-log-done 'time)
  (org-log-into-drawer t)
  
  ;; Tags
  (org-tag-alist
   '((:startgroup)
     ("@work" . ?w)
     ("@home" . ?h)
     ("@errands" . ?e)
     (:endgroup)
     ("planning" . ?p)
     ("review" . ?r)
     ("note" . ?n)))
  
  ;; Capture templates
  (org-capture-templates
   '(("t" "Todo" entry (file+headline org-default-notes-file "Tasks")
      "* TODO %?\n  %U\n  %a\n  %i" :empty-lines 1)
     ("m" "Meeting" entry (file+headline org-default-notes-file "Meetings")
      "* %? :meeting:\n  %U" :empty-lines 1)
     ("n" "Note" entry (file+headline org-default-notes-file "Notes")
      "* %?\n  %U\n  %i" :empty-lines 1)
     ("j" "Journal" entry (file+datetree "~/org/journal.org")
      "* %?\n  Entered on %U\n  %i" :empty-lines 1)))
  
  :bind
  (("C-c o l" . org-store-link)
   ("C-c o a" . org-agenda)
   ("C-c o c" . org-capture)
   :map org-mode-map
   ("C-c C-q" . counsel-org-tag))
  
  :hook
  (org-mode . visual-line-mode)
  (org-mode . variable-pitch-mode))

;; Redisplay images after execution
(setq org-redisplay-inline-images t)
;; Or use a list for different sizes
(setq org-image-actual-width '(300 500 800))
(setq org-yank-image-save-method 'attach)
(setq org-yank-image-save-method "images/")

;; ============================================================================
;; MODERN BULLETS
;; ============================================================================

(use-package org-modern
  :ensure t
  :hook (org-mode . org-modern-mode)
  :custom
  (org-modern-star '("◉" "○" "✸" "✿" "✤" "✜" "◆" "▶"))
  (org-modern-table-vertical 1)
  (org-modern-table-horizontal 0.2)
  (org-modern-list '((43 . "➤") (45 . "–") (42 . "•")))
  (org-modern-todo-faces
   '(("TODO" :inverse-video t :inherit org-todo)
     ("PROG" :inverse-video t :inherit +org-todo-active)
     ("WAIT" :inverse-video t :inherit +org-todo-onhold)
     ("DONE" :inverse-video t :inherit org-done)))
  (org-modern-footnote (cons nil (cadr org-script-display)))
  (org-modern-block-fringe nil)
  (org-modern-block-name '("" . ""))
  (org-modern-keyword nil)
  (org-modern-timestamp t)
  (org-modern-priority t))

;; ============================================================================
;; ELEGANT FONTS
;; ============================================================================

(custom-set-faces
 '(org-level-1 ((t (:inherit outline-1 :height 1.4 :weight bold))))
 '(org-level-2 ((t (:inherit outline-2 :height 1.3 :weight semi-bold))))
 '(org-level-3 ((t (:inherit outline-3 :height 1.2 :weight semi-bold))))
 '(org-level-4 ((t (:inherit outline-4 :height 1.1 :weight semi-bold))))
 '(org-level-5 ((t (:inherit outline-5 :height 1.0))))
 '(org-document-title ((t (:height 2.0 :weight bold :underline nil))))
 '(variable-pitch ((t (:family "ETBembo" :height 180 :weight normal))))
 '(fixed-pitch ((t (:family "JetBrains Mono" :height 140)))))

;; Fix mixed pitch for specific elements
;;(set-face-attribute 'org-block nil :foreground nil :inherit 'fixed-pitch)
;;(set-face-attribute 'org-table nil :inherit 'fixed-pitch)
;;(set-face-attribute 'org-formula nil :inherit 'fixed-pitch)
;;(set-face-attribute 'org-code nil :inherit '(shadow fixed-pitch))
;;(set-face-attribute 'org-verbatim nil :inherit '(shadow fixed-pitch))
;;(set-face-attribute 'org-special-keyword nil :inherit '(font-lock-comment-face fixed-pitch))
;;(set-face-attribute 'org-meta-line nil :inherit '(font-lock-comment-face fixed-pitch))
;;(set-face-attribute 'org-checkbox nil :inherit 'fixed-pitch)

;; ============================================================================
;; BABEL LANGUAGES
;; ============================================================================

(org-babel-do-load-languages
 'org-babel-load-languages
 '((emacs-lisp . t)
   (python . t)
   (shell . t)
   (js . t)
   (sql . t)))

;; ============================================================================
;; MODERN AGENDA VIEW
;; ============================================================================

(setq org-agenda-custom-commands
      '(("d" "Dashboard"
         ((agenda "" ((org-agenda-span 7)
                      (org-agenda-start-day "-1d")
                      (org-deadline-warning-days 7)))
          (todo "NEXT"
                ((org-agenda-overriding-header "Next Actions")))
          (todo "PROG"
                ((org-agenda-overriding-header "In Progress")))
          (todo "WAIT"
                ((org-agenda-overriding-header "Waiting On")))))
        
        ("n" "Next Tasks"
         ((todo "NEXT"
                ((org-agenda-overriding-header "Next Tasks")))))
        
        ("w" "Work"
         ((tags-todo "@work"
                     ((org-agenda-overriding-header "Work Tasks")))))))

;; ============================================================================
;; SUPER AGENDA (OPTIONAL - REQUIRES INSTALLATION)
;; ============================================================================

(use-package org-super-agenda
  :ensure t
  :after org-agenda
  :config
  (org-super-agenda-mode)
  :custom
  (org-super-agenda-groups
   '((:name "Today"
      :time-grid t
      :scheduled today)
     (:name "High Priority"
      :priority "A")
     (:name "In Progress"
      :todo "PROG")
     (:name "Next Actions"
      :todo "NEXT")
     (:name "Waiting"
      :todo "WAIT")
     (:name "Projects"
      :tag "project"))))

;; ============================================================================
;; EXPORT SETTINGS
;; ============================================================================

(setq org-export-with-smart-quotes t
      org-export-with-toc nil
      org-html-validation-link nil
      org-latex-listings 'minted
      org-latex-packages-alist '(("" "minted")))

;; ============================================================================
;; KEYBINDINGS
;; ============================================================================

(with-eval-after-load 'org
  (define-key org-mode-map (kbd "C-c C-x C-r") 'org-clock-report)
  (define-key org-mode-map (kbd "C-c C-x C-o") 'org-clock-out)
  (define-key org-mode-map (kbd "C-c C-x C-i") 'org-clock-in))

(provide 'org-config)
#+end_src
** Line Numbers & Highlighting

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/ui.el
(setq display-line-numbers 'relative)
(global-display-line-numbers-mode 1)
(global-hl-line-mode +1)          ;; highlight current line
#+end_src

** Indentation

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/ui.el
;;(setq-default indent-tabs-mode nil) ;; use spaces hehe
;;(setq-default tab-width 4)
(setq-default indent-tabs-mode t)
(setq-default tab-width 2) ; Assuming you want your tabs to be two spaces wide
(setq truncate-lines t)
#+end_src

** Yes/No Prompt


s

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/ui.el
(fset 'yes-or-no-p 'y-or-n-p)
#+end_src

** Auto-save Configuration

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/ui.el
(setq auto-save-default nil)
;; Optional: Change auto-save file location (to avoid clutter)
(setq auto-save-file-name-transforms
      `((".*" ,(expand-file-name "~/.config/emacs/auto-saves/") t)))
#+end_src

** Cursor Configuration

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/ui.el
(setq-default cursor-type 'bar)  ; Slim vertical bar cursor
(blink-cursor-mode 1)
(setq cursor-in-non-selected-windows nil)
#+end_src

** Editing Modes

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/ui.el
(smartparens-global-mode t)
(add-hook 'prog-mode-hook #'rainbow-delimiters-mode)
(delete-selection-mode 1)
#+end_src

** Web Mode Settings

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/ui.el
;; Enable automatic closing of tags
(setq web-mode-enable-auto-closing t)
;; Enable automatic pair insertion (like <div></div>)
(setq web-mode-enable-auto-pairing t)
#+end_src

** Theme

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/ui.el
(setq custom-safe-themes t)
#+end_src

** Dired Settings

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/ui.el
;; dired
(setq dired-listing-switches "-lah --group-directories-first")
#+end_src

** Dashboard

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/ui.el
(setq dashboard-banner-logo-title "There is no system but GNU, and Linux is one of its kernels")
(setq dashboard-center-content t)
;;(setq dashboard-startup-banner "~/Pictures/basta.png")
(setq dashboard-startup-banner "~/.config/emacs/banner.txt")
(setq dashboard-vertically-center-content t)
(dashboard-open)

#+end_src

** Custom Functions

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/ui.el
(defun jetbrains ()
  "Starts jetbrains style"
  (interactive)
  (load-theme 'jetbrains-darcula t)
  (projectile-switch-project)
  (treemacs))
(defun thanos/wtype-text (text)
  "Process TEXT for wtype, handling newlines properly."
  (let* ((has-final-newline (string-match-p "\n$" text))
         (lines (split-string text "\n"))
         (last-idx (1- (length lines))))
    (string-join
     (cl-loop for line in lines
              for i from 0
              collect (cond
                       ;; Last line without final newline
                       ((and (= i last-idx) (not has-final-newline))
                        (format "wtype -s 350 \"%s\"" 
                                (replace-regexp-in-string "\"" "\\\\\"" line)))
                       ;; Any other line
                       (t
                        (format "wtype -s 350 \"%s\" && wtype -k Return" 
                                (replace-regexp-in-string "\"" "\\\\\"" line)))))
     " && ")))

(defun edit ()
  "Open emcas config in a new buffer."
  (interactive)
  (find-file (concat (getenv "HOME") "/.config/emacs/readme.org")))

#+end_src
* Custom funcs
#+begin_src emacs-lisp :tangle ~/.config/emacs/init.el
(defun today()
	(interactive)
	(message (format-time-string "%A(%d) %B V%W ")))

(defun erofi ()
  "Prompt using Vertico to run an executable from /usr/bin in a temporary frame."
  (interactive)
  ;; Set a temporary frame title
  (let ((frame (selected-frame))
        (files (seq-filter
                (lambda (f)
                  (file-executable-p (concat "/usr/bin/" f)))
                (directory-files "/usr/bin" nil "^[^.].*"))))
    (unwind-protect
        (progn
          (set-frame-parameter frame 'name "erofi") ;; set WM title
          ;; Prompt for executable
          (let ((choice (completing-read "Run: " files nil t)))
            (when (and choice (not (string= choice "")))
              ;; Run asynchronously
              (async-shell-command choice))))
       (delete-frame frame)
      )))

(defun my/open-file()
	(interactive)
	(let ((path (string-trim (thing-at-point 'string t) "\"" "\"")))
		(message "Opening file %s" path)
		(find-file path)))
#+end_src

* Emacs everwhere
This is a script that lets you edit any text by opening the text in a emacs buffer
then when you are done editing it replaced the text

+ wtype is depedency 

#+begin_src emacs-lisp :tangle ~/.config/emacs/init.el
(defun thanos/wtype-text (text)
  "Process TEXT for wtype, handling newlines properly."
  (let* ((has-final-newline (string-match-p "\n$" text))
         (lines (split-string text "\n"))
         (last-idx (1- (length lines))))
    (string-join
     (cl-loop for line in lines
              for i from 0
              collect (cond
                       ;; Last line without final newline
                       ((and (= i last-idx) (not has-final-newline))
                        (format "wtype -s 350 \"%s\"" 
                                (replace-regexp-in-string "\"" "\\\\\"" line)))
                       ;; Any other line
                       (t
                        (format "wtype -s 350 \"%s\" && wtype -k Return" 
                                (replace-regexp-in-string "\"" "\\\\\"" line)))))
     " && ")))

(defun thanos/type ()
  "Launch a temporary frame with a clean buffer for typing."
  (interactive)
  (let ((frame (make-frame '((name . "emacs-float")
                             (fullscreen . 0)
                             (undecorated . t)
                             (width . 70)
                             (height . 20))))
        (buf (get-buffer-create "emacs-float")))
    (select-frame frame)
    (switch-to-buffer buf)
    (erase-buffer)
    (org-mode)
    (setq-local header-line-format
                (format " %s to insert text or %s to cancel."
                        (propertize "C-c C-c" 'face 'help-key-binding)
			(propertize "C-c C-k" 'face 'help-key-binding)))
    (local-set-key (kbd "C-c C-k")
		   (lambda () (interactive)
		     (kill-new (buffer-string))
		     (delete-frame)))
    (local-set-key (kbd "C-c C-c")
		   (lambda () (interactive)
		     (start-process-shell-command
		      "wtype" nil
		      (thanos/wtype-text (buffer-string)))
		     (delete-frame)))))
#+end_src

* Tree-sitter (alisp/treesitter.el)

Tree-sitter configuration (file needs to be created if you have one).

#+begin_src emacs-lisp :tangle ~/.config/emacs/lisp/treesitter.el
;; Add your tree-sitter configuration here
;; This file is loaded but you haven't provided its contents
;; Example:
;; (setq treesit-language-source-alist
;;       '((bash "https://github.com/tree-sitter/tree-sitter-bash")
;;         (python "https://github.com/tree-sitter/tree-sitter-python")))
#+end_src

* exwm
 ~/.config/emacs/init.el
#+begin_src emacs-lisp :tangle no
(use-package exwm
  :ensure t
  :config
  ;; Number of workspaces
  (setq exwm-workspace-number 4)

  ;; Make class name the buffer name
  (add-hook 'exwm-update-class-hook
            (lambda ()
              (exwm-workspace-rename-buffer exwm-class-name)))

  ;; Global keybindings (these work everywhere)
  (setq exwm-input-global-keys
        `(
          ;; Reset to line-mode (C-c C-k)
          ([?\s-r] . exwm-reset)
          ;; Switch workspace
          ([?\s-w] . exwm-workspace-switch)
          ;; Launch application
          ([?\s-&] . (lambda (command)
    
                   (interactive (list (read-shell-command "$ ")))
                       (start-process-shell-command command nil command)))))
(defun my-exwm-terminal ()
  (interactive)
  (start-process "terminal" nil "kitty"))

(exwm-input-set-key (kbd "s-<return>") 'my-exwm-terminal)
	
  ;; Line-mode vs char-mode switching
  (define-key exwm-mode-map [?\C-q] #'exwm-input-send-next-key)

;; Optional: switch workspaces with Super+number
(dotimes (i exwm-workspace-number)
  (exwm-input-set-key (kbd (format "s-%d" (1+ i)))
                      `(lambda () (interactive) (exwm-workspace-switch ,i))))

;; show some info
(display-battery-mode)
(display-time)
;;(exwm- modeline-mode)


;; Enable system tray in EXWM
(require 'exwm-systemtray)
;;(exwm-systemtray-enable)

;; Optional: configure refresh interval (in seconds)
(setq exwm-systemtray-refresh-interval 2)

  ;; Enable EXWM
  (exwm-enable))


#+end_src

* Notes

# - The ~lisp/secret.el~ file is loaded but not included here (for security reasons)

# - (setq wakatime-api-key "")
# - (setq gemini-api-key "")


- Make sure to run ~M-x all-the-icons-install-fonts~ after first setup
- For LSP Java, ensure you have a Java language server installed
- Run ~M-x jtsx-install-treesit-language~ to install tree-sitter grammars for JavaScript/TypeScript


